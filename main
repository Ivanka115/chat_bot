import telebot
from telebot.types import Message
import random
import os
import requests

bot = telebot.TeleBot("")

@bot.message_handler(commands = ["start"])
def start_cmd(message: Message):
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç. –ù–∞–ø–∏—à–∏ /help —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —á—Ç–æ —è —É–º–µ—é.")

@bot.message_handler(commands = ["about"])
def start_cmd(message: Message):
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç! –Ø –ò–≤–∞–Ω–∫–∞ - —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è Python.")

@bot.message_handler(commands = ["coin"])
def coin_cmd(message: Message):
    x = random.randint(0, 1)
    if x == 0:
        bot.send_message(message.chat.id, "–í–∞–º –≤—ã–ø–∞–ª –æ—Ä—ë–ª!")
    else:
        bot.send_message(message.chat.id, "–í–∞–º –≤—ã–ø–∞–ª–∞ —Ä–µ—à–∫–∞!")

@bot.message_handler(commands = ["help"])
def help_cmd(message: Message):
    text = "<b>–ú–æ–∏ –∫–æ–º–∞–Ω–¥—ã: </b>\n" \
    "/start - <i>–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞</i>\n" \
    "/about - <i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ</i>\n" \
    "/coin - <i>–º–æ–Ω–µ—Ç–∫–∞</i>\n" \
    "/knb - <i>–ò–≥—Ä–∞ –∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞</i>\n" \
    "/dice - <i>–ë—Ä–æ—Å–∏—Ç—å –∏–≥—Ä–∞–ª—å–Ω—ã–π –∫—É–±–∏–∫</i>\n" \
    "/help - <i>–æ –∫–æ–º–∞–Ω–¥–µ</i>\n" \
    '<i>–¢–∞–∫–∂–µ –±–æ—Ç —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è "–ø—Ä–∏–≤–µ—Ç" –∏ "–ø–æ–∫–∞"</i>'

    bot.send_message(message.chat.id, text, parse_mode = "HTML")

@bot.message_handler(commands = ['knb'])
def knb_cmd(message: Message):
    bot.send_message(message.chat.id, "–ò–≥—Ä–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å, –Ω–∞–ø–∏—à–∏—Ç–µ –∫–∞–º–µ–Ω—å/–Ω–æ–∂–Ω–∏—Ü—ã/–±—É–º–∞–≥–∞ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞ (—á—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É)")
    bot.register_next_step_handler(message, knb_game)

def knb_game(message: Message):
    text = message.text.lower()
    if text == '–æ—Ç–º–µ–Ω–∞':
        bot.send_message(message.chat.id, "–ò–≥—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –≤–∞–º —Å–Ω–æ–≤–∞ –¥–æ—Å–µ—É–ø–Ω—ã –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã")
        return
    if text not in ['–∫–∞–º–µ–Ω—å', '–Ω–æ–∂–Ω–∏—Ü—ã', '–±—É–º–∞–≥–∞']:
        bot.send_message(message.chat.id, "–í—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–æ, –∏–≥—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –≤–∞–º —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã")
        return
    
    comp = random.choice(['–∫–∞–º–µ–Ω—å', '–Ω–æ–∂–Ω–∏—Ü—ã', '–±—É–º–∞–≥–∞'])

    if text == comp:
        bot.send_message(message.chat.id, "–ù–∏—á—å—è, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∏–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞, –Ω–∞–ø–∏—à–∏—Ç–µ /knb")
        return
    elif (text == '–∫–∞–º–µ–Ω—å' and bot == '–Ω–æ–∂–Ω–∏—Ü—ã') or (text == '–Ω–æ–∂–Ω–∏—Ü—ã' and bot == '–±—É–º–∞–≥–∞') or (text == '–±—É–º–∞–≥–∞' and bot == '–∫–∞–º–µ–Ω—å'):
        bot.send_message(message.chat.id, "–í—ã –ø–æ–±–µ–¥–∏–ª–∏, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∏–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞, –Ω–∞–ø–∏—à–∏—Ç–µ /knb")
        return
    else:
        bot.send_message(message.chat.id, "–í—ã –ø–æ–±–µ–¥–∏–ª–∏, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∏–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞, –Ω–∞–ø–∏—à–∏—Ç–µ /knb")
        return
    
@bot.message_handler(commands = ['dice'])
def dice_cmd(message: Message):
    value = random.randint(1, 6)
    bot.send_message(message.chat.id, f"üé≤ –ö—É–±–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: {value}")
    
@bot.message_handler(func = lambda message: message.text.lower() == '–ø—Ä–∏–≤–µ—Ç')
def hello_text(message: Message):
    bot.send_message(message.chat.id, "–ò —Ç–µ–±–µ –ø—Ä–∏–≤–µ—Ç! –ù–∞–ø–∏—à–∏ /help —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —á—Ç–æ —è —É–º–µ—é.")

@bot.message_handler(func = lambda message: message.text.lower() == '–ø–æ–∫–∞')
def goodbye_text(message: Message):
    bot.send_message(message.chat.id, "–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è —Å–∫–æ—Ä–µ–µ!")


@bot.message_handler(commands = ['note'])
def note_cmd(message: Message):
    bot.send_message(message.chat.id, "–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫—É")
    bot.register_next_step_handler(message, add_note)

def add_note(message: Message):
    text = message.text
    filename = f"note_{message.from_user.id}.text"
    with open(filename, "w", encoding = 'utf-8') as file:
        file.write(text)
    bot.send_message(message.chat.id, "–í–∞—à–∞ –∑–∞–º–µ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞")

@bot.message_handler(commands = ['read'])
def read_cmd(message: Message):
    filename = f"note_{message.from_user.id}.text"
    with open(filename, 'r',  encoding = 'utf-8') as file:
        text = file.read()
    bot.send_message(message.chat.id, f"–í–∞—à–∞ –∑–∞–º–µ—Ç–∫–∞: {text}")

@bot.message_handler(commands = ['mem'])
def mem_cmd(message: Message):
    images = os.listdir('images')
    image = random.choice(images)
    image = 'images/' + image

    with open(image, 'rb') as file:
        bot.send_photo(message.chat.id, photo = file, caption = "–õ–æ–≤–∏ –º–µ–º—á–∏–∫!")

@bot.message_handler(commands = ['duck'])
def duck_cmd(message: Message):
    url = 'https://random-d.uk/api/random'
    result = requests.get(url)
    data = result.json()
    url = data.get('url')
    bot.send_message(message.chat.id, url)

# ========================================================================================================================

@bot.message_handler(commands = ['name'])
def name_cmd(message: Message):
    bot.send_message(message.chat.id, f"https://api.dicebear.com/9.x/personas/svg?seed={message.from_user.first_name}")

# ========================================================================================================================

# API –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–µ)
ANIMAL_APIS = [
    'https://api.thecatapi.com/v1/images/search',  # –ö–æ—à–∫–∏
    'https://dog.ceo/api/breeds/image/random',    # –°–æ–±–∞–∫–∏
    'https://randomfox.ca/floof/',                 # –õ–∏—Å—ã
    'https://random-d.uk/api/v2/random'           # –£—Ç–∫–∏
]

@bot.message_handler(commands=['animals'])
def animals_cmd(message: Message):
    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π API
    api_url = random.choice(ANIMAL_APIS)

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    result = requests.get(api_url)
    data = result.json()

    # –ò–∑–≤–ª–µ–∫–∞–µ–º URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç API
    if 'thecatapi' in api_url:
        url = data[0]['url']
    elif 'dog.ceo' in api_url:
        url = data['message']
    elif 'randomfox' in api_url:
        url = data['image']
    elif 'random-d.uk' in api_url:
        url = data['url']
    else:
        url = None
            
    if url:
        bot.send_photo(message.chat.id, url)
    else:
        bot.send_message(message.chat.id, "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ üêæ")

bot.infinity_polling()
